{"version":3,"sources":["webpack:///server.js","webpack:///webpack/bootstrap cc67762d521949634e03","webpack:///./src/server/server.js","webpack:///external \"source-map-support/register\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"chalk\"","webpack:///external \"rxjs\"","webpack:///./src/shared/operators.js","webpack:///./src/shared/observable-socket.js","webpack:///./src/server/modules/users.js","webpack:///external \"lodash\"","webpack:///./src/server/lib/module.js","webpack:///./src/shared/validation/users.js","webpack:///./src/shared/validator.js","webpack:///./src/server/modules/playlist.js","webpack:///./src/server/modules/chat.js","webpack:///./src/shared/validation/chat.js","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///external \"webpack\"","webpack:///./webpack.client.js","webpack:///external \"path\"","webpack:///external \"extract-text-webpack-plugin\""],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","startServer","server","listen","port","console","log","_express","_express2","_http","_http2","_socket","_socket2","_chalk","_chalk2","_rxjs","_observableSocket","_users","_playlist","_chat","app","Server","io","isDevelopment","process","env","NODE_ENV","USE_WEBPACK","webpackMiddleware","webpackHotMiddleware","webpack","clientConfig","compiler","use","publicPath","stats","colers","chunks","assets","timing","hash","version","bgRed","set","static","useExternalStyles","get","req","res","render","videoServices","playlistRepository","users","UsersModule","chat","ChatModule","playlist","PlaylistModule","on","socket","request","connection","remoteAddress","client","ObservableSocket","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","mod","value","registerClient","err","return","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","clientRegistered","PORT","Observable","merge","apply","map","init$","subscribe","complete","error","stack","require","prototype","safeSubscribe","subscription","this","item","e","unsubscribe","catchWrap","catch","of","_classCallCheck","instance","Constructor","TypeError","clientMessage","message","Error","fail","throw","success","successObservable","Object","defineProperty","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","empty","_this","_state","_actionCallbacks","_requests","_nextRequestId","status$","on$","isConnected","attempt","isReconnecting","publishReplay","refCount","state","event","fromEvent","callback","off","arg","emit","action","_registerCallbacks","subject","ReplaySubject","_this2","hasOwnProperty","_popRequest","_this3","requestId","hasValue","_emitError","actions","onAction","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_lodash","_lodash2","_module","AuthContext","_ModuleBase","getPrototypeOf","_io","_userList","username","reduce","ch","charCodeAt","Math","abs","hue","saturation","lightness","auth","isLoggedIn","trim","validator","validateLogin","isValid","throw$","name","color","getColorForUsername","push","getUserForClient","index","indexOf","splice","onActions","users:list","auth:login","_ref","loginClient$","auth:logout","logoutClient","ModuleBase","_validator","Validator","USERNAME_REGEX","test","_errors","join","errors","usersModule","_repository","_services","MAX_HISTORY","BATCH_SIZE","_chatLog","user","type","validateSendMessage","newMessage","time","Date","getTime","chat:list","chat:add","sendMessage","includes","MESSAGE_TYPES","createConfig","isDebug","devTool","plugins","optimize","CommonsChunkPlugin","cssLoader","loader","sassLoader","appEntry","HotModuleReplacementPlugin","UglifyJsPlugin","ExtractTextPlugin","extract","devtool","entry","application","vendor","vendorModules","output","path","dirname","filename","resolve","alias","shared","loaders","exclude"],"mappings":"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","file":"server.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\t__webpack_require__(1);\n\t\n\tvar _express = __webpack_require__(2);\n\t\n\tvar _express2 = _interopRequireDefault(_express);\n\t\n\tvar _http = __webpack_require__(3);\n\t\n\tvar _http2 = _interopRequireDefault(_http);\n\t\n\tvar _socket = __webpack_require__(4);\n\t\n\tvar _socket2 = _interopRequireDefault(_socket);\n\t\n\tvar _chalk = __webpack_require__(5);\n\t\n\tvar _chalk2 = _interopRequireDefault(_chalk);\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\t__webpack_require__(7);\n\t\n\tvar _observableSocket = __webpack_require__(8);\n\t\n\tvar _users = __webpack_require__(9);\n\t\n\tvar _playlist = __webpack_require__(14);\n\t\n\tvar _chat = __webpack_require__(15);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\t// --------------------------------------\n\t// Setup\n\tvar app = (0, _express2.default)();\n\tvar server = new _http2.default.Server(app);\n\tvar io = (0, _socket2.default)(server);\n\t\n\tvar isDevelopment = process.env.NODE_ENV !== \"production\";\n\t\n\t// --------------------------------------\n\t// Client Webpack\n\tif (process.env.USE_WEBPACK === \"true\") {\n\t\tvar webpackMiddleware = __webpack_require__(17),\n\t\t    webpackHotMiddleware = __webpack_require__(18),\n\t\t    webpack = __webpack_require__(19),\n\t\t    clientConfig = __webpack_require__(20);\n\t\n\t\tvar compiler = webpack(clientConfig);\n\t\tapp.use(webpackMiddleware(compiler, {\n\t\t\tpublicPath: \"/build/\",\n\t\t\tstats: {\n\t\t\t\tcolers: true,\n\t\t\t\tchunks: false,\n\t\t\t\tassets: false,\n\t\t\t\ttiming: false,\n\t\t\t\tmodules: false,\n\t\t\t\thash: false,\n\t\t\t\tversion: false\n\t\t\t}\n\t\t}));\n\t\n\t\tapp.use(webpackHotMiddleware(compiler));\n\t\tconsole.log(_chalk2.default.bgRed(\"Using webPack Dev Middleware. This is for dev only!\"));\n\t}\n\t\n\t// --------------------------------------\n\t// Configure Express\n\tapp.set(\"view engine\", \"jade\");\n\tapp.use(_express2.default.static(\"public\"));\n\t\n\tvar useExternalStyles = !isDevelopment;\n\tapp.get(\"/\", function (req, res) {\n\t\tres.render(\"index\", { useExternalStyles: useExternalStyles });\n\t});\n\t\n\t// --------------------------------------\n\t// Services\n\tvar videoServices = [];\n\tvar playlistRepository = {};\n\t\n\t// --------------------------------------\n\t// Modules\n\tvar users = new _users.UsersModule(io);\n\tvar chat = new _chat.ChatModule(io, users);\n\tvar playlist = new _playlist.PlaylistModule(io, users, playlistRepository, videoServices);\n\tvar modules = [users, chat, playlist];\n\t\n\t// --------------------------------------\n\t// Socket\n\tio.on(\"connection\", function (socket) {\n\t\tconsole.log(\"Got connection from \" + socket.request.connection.remoteAddress);\n\t\n\t\tvar client = new _observableSocket.ObservableSocket(socket);\n\t\tvar _iteratorNormalCompletion = true;\n\t\tvar _didIteratorError = false;\n\t\tvar _iteratorError = undefined;\n\t\n\t\ttry {\n\t\t\tfor (var _iterator = modules[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n\t\t\t\tvar mod = _step.value;\n\t\n\t\t\t\tmod.registerClient(client);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t_didIteratorError = true;\n\t\t\t_iteratorError = err;\n\t\t} finally {\n\t\t\ttry {\n\t\t\t\tif (!_iteratorNormalCompletion && _iterator.return) {\n\t\t\t\t\t_iterator.return();\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tif (_didIteratorError) {\n\t\t\t\t\tthrow _iteratorError;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\n\t\tvar _iteratorNormalCompletion2 = true;\n\t\tvar _didIteratorError2 = false;\n\t\tvar _iteratorError2 = undefined;\n\t\n\t\ttry {\n\t\t\tfor (var _iterator2 = modules[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n\t\t\t\tvar _mod = _step2.value;\n\t\n\t\t\t\t_mod.clientRegistered(client);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t_didIteratorError2 = true;\n\t\t\t_iteratorError2 = err;\n\t\t} finally {\n\t\t\ttry {\n\t\t\t\tif (!_iteratorNormalCompletion2 && _iterator2.return) {\n\t\t\t\t\t_iterator2.return();\n\t\t\t\t}\n\t\t\t} finally {\n\t\t\t\tif (_didIteratorError2) {\n\t\t\t\t\tthrow _iteratorError2;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\t\n\t// --------------------------------------\n\t// Startup\n\t\n\tvar port = process.env.PORT || 3000;\n\tfunction startServer() {\n\t\tserver.listen(port, function () {\n\t\t\tconsole.log(\"Started http server on \" + port);\n\t\t});\n\t}\n\t\n\t_rxjs.Observable.merge.apply(_rxjs.Observable, _toConsumableArray(modules.map(function (m) {\n\t\treturn m.init$();\n\t}))).subscribe({\n\t\tcomplete: function complete() {\n\t\t\tstartServer();\n\t\t},\n\t\terror: function error(_error) {\n\t\t\tconsole.error(\"Could not init module: \" + (_error.stack || _error));\n\t\t}\n\t});\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"source-map-support/register\");\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"express\");\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"http\");\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"socket.io\");\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"chalk\");\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"rxjs\");\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\t_rxjs.Observable.prototype.safeSubscribe = function (next, error, complete) {\n\t\tvar subscription = this.subscribe(function (item) {\n\t\t\ttry {\n\t\t\t\tnext(item);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e.stack || e);\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t}\n\t\t}, error, complete);\n\t\n\t\treturn subscription;\n\t};\n\t\n\t_rxjs.Observable.prototype.catchWrap = function () {\n\t\treturn this.catch(function (error) {\n\t\t\treturn _rxjs.Observable.of({ error: error });\n\t\t});\n\t};\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.ObservableSocket = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\texports.clientMessage = clientMessage;\n\texports.fail = fail;\n\texports.success = success;\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction clientMessage(message) {\n\t\tvar error = new Error(message);\n\t\terror.clientMessage = message;\n\t\treturn error;\n\t}\n\t\n\tfunction fail(message) {\n\t\treturn _rxjs.Observable.throw({ clientMessage: message });\n\t}\n\t\n\tvar successObservable = _rxjs.Observable.empty();\n\tfunction success() {\n\t\treturn successObservable;\n\t}\n\t\n\tvar ObservableSocket = exports.ObservableSocket = function () {\n\t\t_createClass(ObservableSocket, [{\n\t\t\tkey: \"isConnected\",\n\t\t\tget: function get() {\n\t\t\t\treturn this._state.isConnected;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"isReconnecting\",\n\t\t\tget: function get() {\n\t\t\t\treturn this._state.isReconnecting;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"isTotallyDead\",\n\t\t\tget: function get() {\n\t\t\t\treturn !this.isConnected && !this.isReconnecting;\n\t\t\t}\n\t\t}]);\n\t\n\t\tfunction ObservableSocket(socket) {\n\t\t\tvar _this = this;\n\t\n\t\t\t_classCallCheck(this, ObservableSocket);\n\t\n\t\t\tthis._socket = socket;\n\t\t\tthis._state = {};\n\t\t\tthis._actionCallbacks = {};\n\t\t\tthis._requests = {};\n\t\t\tthis._nextRequestId = 0;\n\t\n\t\t\t// socket.on(\"connect\", () => this._state = {isConnected: true});\n\t\t\t// socket.on(\"disconnect\", () => this._state = {isConnected: false});\n\t\t\tthis.status$ = _rxjs.Observable.merge(this.on$(\"connect\").map(function () {\n\t\t\t\treturn { isConnected: true };\n\t\t\t}), this.on$(\"disconnect\").map(function () {\n\t\t\t\treturn { isConnected: false };\n\t\t\t}), this.on$(\"reconnecting\").map(function (attempt) {\n\t\t\t\treturn { isConnected: false, isReconnecting: true, attempt: attempt };\n\t\t\t}), this.on$(\"reconnect_fail\").map(function () {\n\t\t\t\treturn { isConnected: false, isReconnecting: false };\n\t\t\t})).publishReplay(1).refCount();\n\t\n\t\t\tthis.status$.subscribe(function (state) {\n\t\t\t\treturn _this._state = state;\n\t\t\t});\n\t\t}\n\t\n\t\t// ---------------------\n\t\t// Basic Wrappers\n\t\n\t\n\t\t_createClass(ObservableSocket, [{\n\t\t\tkey: \"on$\",\n\t\t\tvalue: function on$(event) {\n\t\t\t\treturn _rxjs.Observable.fromEvent(this._socket, event);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"on\",\n\t\t\tvalue: function on(event, callback) {\n\t\t\t\tthis._socket.on(event, callback);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"off\",\n\t\t\tvalue: function off(event, callback) {\n\t\t\t\tthis._socket.off(event, callback);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"emit\",\n\t\t\tvalue: function emit(event, arg) {\n\t\t\t\tthis._socket.emit(event, arg);\n\t\t\t}\n\t\n\t\t\t// ---------------------\n\t\t\t// Emit (Client Side)\n\t\n\t\t}, {\n\t\t\tkey: \"emitAction$\",\n\t\t\tvalue: function emitAction$(action, arg) {\n\t\t\t\tvar id = this._nextRequestId++;\n\t\t\t\tthis._registerCallbacks(action);\n\t\n\t\t\t\tvar subject = this._requests[id] = new _rxjs.ReplaySubject(1);\n\t\t\t\tthis._socket.emit(action, arg, id);\n\t\t\t\treturn subject;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"_registerCallbacks\",\n\t\t\tvalue: function _registerCallbacks(action) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tif (this._actionCallbacks.hasOwnProperty(action)) return;\n\t\n\t\t\t\tthis._socket.on(action, function (arg, id) {\n\t\t\t\t\tvar request = _this2._popRequest(id);\n\t\t\t\t\tif (!request) return;\n\t\n\t\t\t\t\trequest.next(arg);\n\t\t\t\t\trequest.complete();\n\t\t\t\t});\n\t\n\t\t\t\tthis._socket.on(action + \":fail\", function (arg, id) {\n\t\t\t\t\tvar request = _this2._popRequest(id);\n\t\t\t\t\tif (!request) return;\n\t\n\t\t\t\t\trequest.error(arg);\n\t\t\t\t});\n\t\n\t\t\t\tthis._actionCallbacks[action] = true;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"_popRequest\",\n\t\t\tvalue: function _popRequest(id) {\n\t\t\t\tif (!this._requests.hasOwnProperty(id)) {\n\t\t\t\t\tconsole.error(\"Event with \" + id + \" was returned twice, or the server did not send back an ID\");\n\t\t\t\t}\n\t\n\t\t\t\tvar request = this._requests[id];\n\t\t\t\tdelete this._requests[id];\n\t\t\t\treturn request;\n\t\t\t}\n\t\n\t\t\t// ---------------------\n\t\t\t// On (Server Side)\n\t\n\t\t}, {\n\t\t\tkey: \"onAction\",\n\t\t\tvalue: function onAction(action, callback) {\n\t\t\t\tvar _this3 = this;\n\t\n\t\t\t\tthis._socket.on(action, function (arg, requestId) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar value = callback(arg);\n\t\t\t\t\t\tif (!value) {\n\t\t\t\t\t\t\t_this3._socket.emit(action, null, requestId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tif (typeof value.subscribe !== \"function\") {\n\t\t\t\t\t\t\t_this3._socket.emit(action, value, requestId);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\n\t\t\t\t\t\tvar hasValue = false;\n\t\t\t\t\t\tvalue.subscribe({\n\t\t\t\t\t\t\tnext: function next(item) {\n\t\t\t\t\t\t\t\tif (hasValue) throw new Error(\"Action \" + action + \" produced more than one value\");\n\t\n\t\t\t\t\t\t\t\t_this3._socket.emit(action, item, requestId);\n\t\t\t\t\t\t\t\thasValue = true;\n\t\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t\terror: function error(_error) {\n\t\t\t\t\t\t\t\t_this3._emitError(action, requestId, _error);\n\t\t\t\t\t\t\t\tconsole.error(_error.stack || _error);\n\t\t\t\t\t\t\t},\n\t\n\t\t\t\t\t\t\tcomplete: function complete() {\n\t\t\t\t\t\t\t\tif (!hasValue) _this3._socket.emit(action, null, requestId);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tif (typeof requestId !== \"undefined\") _this3._emitError(action, requestId, error);\n\t\n\t\t\t\t\t\tconsole.error(error.stack || error);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"onActions\",\n\t\t\tvalue: function onActions(actions) {\n\t\t\t\tfor (var action in actions) {\n\t\t\t\t\tif (!actions.hasOwnProperty(action)) continue;\n\t\n\t\t\t\t\tthis.onAction(action, actions[action]);\n\t\t\t\t}\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"_emitError\",\n\t\t\tvalue: function _emitError(action, id, error) {\n\t\t\t\tvar message = error && error.clientMessage || \"Fatal Error\";\n\t\t\t\tthis._socket.emit(action + \":fail\", { message: message }, id);\n\t\t\t}\n\t\t}]);\n\n\t\treturn ObservableSocket;\n\t}();\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.UsersModule = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _lodash = __webpack_require__(10);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\tvar _module = __webpack_require__(11);\n\t\n\tvar _users = __webpack_require__(12);\n\t\n\tvar _observableSocket = __webpack_require__(8);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar AuthContext = Symbol(\"AuthContext\");\n\t\n\tvar UsersModule = exports.UsersModule = function (_ModuleBase) {\n\t\t_inherits(UsersModule, _ModuleBase);\n\t\n\t\tfunction UsersModule(io) {\n\t\t\t_classCallCheck(this, UsersModule);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (UsersModule.__proto__ || Object.getPrototypeOf(UsersModule)).call(this));\n\t\n\t\t\t_this._io = io;\n\t\t\t_this._userList = [];\n\t\t\t_this._users = {};\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(UsersModule, [{\n\t\t\tkey: \"getColorForUsername\",\n\t\t\tvalue: function getColorForUsername(username) {\n\t\t\t\tvar hash = _lodash2.default.reduce(username, function (hash, ch) {\n\t\t\t\t\treturn ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash;\n\t\t\t\t}, 0);\n\t\n\t\t\t\thash = Math.abs(hash);\n\t\t\t\tvar hue = hash % 360,\n\t\t\t\t    saturation = hash % 25 + 70,\n\t\t\t\t    lightness = 100 - (hash % 15 + 35);\n\t\n\t\t\t\treturn \"hsl(\" + hue + \", \" + saturation + \"%, \" + lightness + \"%)\";\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"getUserForClient\",\n\t\t\tvalue: function getUserForClient(client) {\n\t\t\t\tvar auth = client[AuthContext];\n\t\t\t\tif (!auth) return null;\n\t\n\t\t\t\treturn auth.isLoggedIn ? auth : null;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"loginClient$\",\n\t\t\tvalue: function loginClient$(client, username) {\n\t\t\t\tusername = username.trim();\n\t\n\t\t\t\tvar validator = (0, _users.validateLogin)(username);\n\t\t\t\tif (!validator.isValid) return validator.throw$();\n\t\n\t\t\t\tif (this._users.hasOwnProperty(username)) return (0, _observableSocket.fail)(\"Username \" + username + \" is already taken\");\n\t\n\t\t\t\tvar auth = client[AuthContext] || (client[AuthContext] = {});\n\t\t\t\tif (auth.isLoggedIn) return (0, _observableSocket.fail)(\"You are already logged in\");\n\t\n\t\t\t\tauth.name = username;\n\t\t\t\tauth.color = this.getColorForUsername(username);\n\t\t\t\tauth.isLoggedIn = true;\n\t\n\t\t\t\tthis._users[username] = client;\n\t\t\t\tthis._userList.push(auth);\n\t\n\t\t\t\tthis._io.emit(\"users:added\", auth);\n\t\t\t\tconsole.log(\"User \" + username + \" logged in\");\n\t\t\t\treturn _rxjs.Observable.of(auth);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"logoutClient\",\n\t\t\tvalue: function logoutClient(client) {\n\t\t\t\tvar auth = this.getUserForClient(client);\n\t\t\t\tif (!auth) return;\n\t\n\t\t\t\tvar index = this._userList.indexOf(auth);\n\t\t\t\tthis._userList.splice(index, 1);\n\t\t\t\tdelete this._users[auth.name];\n\t\t\t\tdelete client[AuthContext];\n\t\n\t\t\t\tthis._io.emit(\"users:removed\", auth);\n\t\t\t\tconsole.log(\"User \" + auth.name + \" logged out\");\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"registerClient\",\n\t\t\tvalue: function registerClient(client) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tclient.onActions({\n\t\t\t\t\t\"users:list\": function usersList() {\n\t\t\t\t\t\treturn _this2._userList;\n\t\t\t\t\t},\n\t\n\t\t\t\t\t\"auth:login\": function authLogin(_ref) {\n\t\t\t\t\t\tvar name = _ref.name;\n\t\n\t\t\t\t\t\treturn _this2.loginClient$(client, name);\n\t\t\t\t\t},\n\t\n\t\t\t\t\t\"auth:logout\": function authLogout() {\n\t\t\t\t\t\t_this2.logoutClient(client);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\n\t\t\t\tclient.on(\"disconnect\", function () {\n\t\t\t\t\t_this2.logoutClient(client);\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\n\t\treturn UsersModule;\n\t}(_module.ModuleBase);\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"lodash\");\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.ModuleBase = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/*eslint no-unused-vars: \"off\"*/\n\t\n\tvar ModuleBase = exports.ModuleBase = function () {\n\t\tfunction ModuleBase() {\n\t\t\t_classCallCheck(this, ModuleBase);\n\t\t}\n\t\n\t\t_createClass(ModuleBase, [{\n\t\t\tkey: \"init$\",\n\t\t\tvalue: function init$() {\n\t\t\t\treturn _rxjs.Observable.empty();\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"registerClient\",\n\t\t\tvalue: function registerClient(client) {}\n\t\t}, {\n\t\t\tkey: \"clientRegistered\",\n\t\t\tvalue: function clientRegistered(client) {}\n\t\t}]);\n\n\t\treturn ModuleBase;\n\t}();\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.USERNAME_REGEX = undefined;\n\texports.validateLogin = validateLogin;\n\t\n\tvar _validator = __webpack_require__(13);\n\t\n\tvar USERNAME_REGEX = exports.USERNAME_REGEX = /^[\\w\\d_-]+$/;\n\t\n\tfunction validateLogin(username) {\n\t\tvar validator = new _validator.Validator();\n\t\n\t\tif (username.length >= 10) validator.error(\"Username must be fewer than 10 characters\");\n\t\n\t\tif (!USERNAME_REGEX.test(username)) validator.error(\"Username can only contain numbers, digits, underscores and dashes\");\n\t\n\t\treturn validator;\n\t}\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.Validator = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _rxjs = __webpack_require__(6);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Validator = exports.Validator = function () {\n\t\t_createClass(Validator, [{\n\t\t\tkey: \"isValid\",\n\t\t\tget: function get() {\n\t\t\t\treturn !this._errors.length;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"errors\",\n\t\t\tget: function get() {\n\t\t\t\treturn this._errors;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"message\",\n\t\t\tget: function get() {\n\t\t\t\treturn this._errors.join(\", \");\n\t\t\t}\n\t\t}]);\n\t\n\t\tfunction Validator() {\n\t\t\t_classCallCheck(this, Validator);\n\t\n\t\t\tthis._errors = [];\n\t\t}\n\t\n\t\t_createClass(Validator, [{\n\t\t\tkey: \"error\",\n\t\t\tvalue: function error(message) {\n\t\t\t\tthis._errors.push(message);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"toObject\",\n\t\t\tvalue: function toObject() {\n\t\t\t\tif (this.isValid) return {};\n\t\n\t\t\t\treturn {\n\t\t\t\t\terrors: this._errors,\n\t\t\t\t\tmessage: this.message\n\t\t\t\t};\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"throw$\",\n\t\t\tvalue: function throw$() {\n\t\t\t\treturn _rxjs.Observable.throw({ clientMessage: this.message });\n\t\t\t}\n\t\t}]);\n\n\t\treturn Validator;\n\t}();\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.PlaylistModule = undefined;\n\t\n\tvar _module = __webpack_require__(11);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar PlaylistModule = exports.PlaylistModule = function (_ModuleBase) {\n\t\t_inherits(PlaylistModule, _ModuleBase);\n\t\n\t\tfunction PlaylistModule(io, usersModule, playlistRepository, videoServices) {\n\t\t\t_classCallCheck(this, PlaylistModule);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (PlaylistModule.__proto__ || Object.getPrototypeOf(PlaylistModule)).call(this));\n\t\n\t\t\t_this._io = io;\n\t\t\t_this._users = usersModule;\n\t\t\t_this._repository = playlistRepository;\n\t\t\t_this._services = videoServices;\n\t\t\treturn _this;\n\t\t}\n\t\n\t\treturn PlaylistModule;\n\t}(_module.ModuleBase);\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.ChatModule = undefined;\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _module = __webpack_require__(11);\n\t\n\tvar _chat = __webpack_require__(16);\n\t\n\tvar _observableSocket = __webpack_require__(8);\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar MAX_HISTORY = 100;\n\tvar BATCH_SIZE = 10;\n\t\n\tvar ChatModule = exports.ChatModule = function (_ModuleBase) {\n\t\t_inherits(ChatModule, _ModuleBase);\n\t\n\t\tfunction ChatModule(io, usersModule) {\n\t\t\t_classCallCheck(this, ChatModule);\n\t\n\t\t\tvar _this = _possibleConstructorReturn(this, (ChatModule.__proto__ || Object.getPrototypeOf(ChatModule)).call(this));\n\t\n\t\t\t_this._io = io;\n\t\t\t_this._users = usersModule;\n\t\t\t_this._chatLog = [];\n\t\t\treturn _this;\n\t\t}\n\t\n\t\t_createClass(ChatModule, [{\n\t\t\tkey: \"sendMessage\",\n\t\t\tvalue: function sendMessage(user, message, type) {\n\t\t\t\tmessage = message.trim();\n\t\n\t\t\t\tvar validator = (0, _chat.validateSendMessage)(user, message, type);\n\t\t\t\tif (!validator.isValid) return validator.throw$();\n\t\n\t\t\t\tvar newMessage = {\n\t\t\t\t\tuser: { name: user.name, color: user.color },\n\t\t\t\t\tmessage: message,\n\t\t\t\t\ttime: new Date().getTime(),\n\t\t\t\t\ttype: type\n\t\t\t\t};\n\t\n\t\t\t\tthis._chatLog.push(newMessage);\n\t\n\t\t\t\tif (this._chatLog.length >= MAX_HISTORY) this._chatLog.splice(0, BATCH_SIZE);\n\t\n\t\t\t\tthis._io.emit(\"chat:added\", newMessage);\n\t\t\t}\n\t\t}, {\n\t\t\tkey: \"registerClient\",\n\t\t\tvalue: function registerClient(client) {\n\t\t\t\tvar _this2 = this;\n\t\n\t\t\t\tclient.onActions({\n\t\t\t\t\t\"chat:list\": function chatList() {\n\t\t\t\t\t\treturn _this2._chatLog;\n\t\t\t\t\t},\n\t\n\t\t\t\t\t\"chat:add\": function chatAdd(_ref) {\n\t\t\t\t\t\tvar message = _ref.message,\n\t\t\t\t\t\t    type = _ref.type;\n\t\n\t\t\t\t\t\ttype = type || \"normal\";\n\t\n\t\t\t\t\t\tvar user = _this2._users.getUserForClient(client);\n\t\t\t\t\t\tif (!user) return (0, _observableSocket.fail)(\"You must be logged in\");\n\t\n\t\t\t\t\t\t_this2.sendMessage(user, message, type);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\n\t\treturn ChatModule;\n\t}(_module.ModuleBase);\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.MESSAGE_TYPES = undefined;\n\texports.validateSendMessage = validateSendMessage;\n\t\n\tvar _lodash = __webpack_require__(10);\n\t\n\tvar _lodash2 = _interopRequireDefault(_lodash);\n\t\n\tvar _validator = __webpack_require__(13);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar MESSAGE_TYPES = exports.MESSAGE_TYPES = [\"normal\"];\n\t\n\tfunction validateSendMessage(user, message, type) {\n\t\tvar validator = new _validator.Validator();\n\t\n\t\tif (message.length > 50) validator.error(\"Message must be smaller than 50 characters\");\n\t\n\t\tif (message.trim().length === 0) validator.error(\"Message cannot be empty\");\n\t\n\t\tif (!_lodash2.default.includes(MESSAGE_TYPES, type)) validator.error(\"Invalid message type \" + type);\n\t\n\t\treturn validator;\n\t}\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"webpack-dev-middleware\");\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"webpack-hot-middleware\");\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"webpack\");\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar path = __webpack_require__(21),\n\t    webpack = __webpack_require__(19),\n\t    ExtractTextPlugin = __webpack_require__(22);\n\t\n\tvar vendorModules = [\"jquery\", \"socket.io-client\", \"rxjs\", \"moment\"];\n\t\n\tvar dirname = path.resolve(\"./\");\n\tfunction createConfig(isDebug) {\n\t\tvar devTool = isDebug ? \"eval-source-map\" : \"source-map\";\n\t\tvar plugins = [new webpack.optimize.CommonsChunkPlugin(\"vendor\", \"vendor.js\")];\n\t\n\t\tvar cssLoader = { test: /\\.css$/, loader: \"style!css\" };\n\t\tvar sassLoader = { test: /\\.scss$/, loader: \"style!css!sass\" };\n\t\tvar appEntry = [\"./src/client/application.js\"];\n\t\n\t\tif (!isDebug) {\n\t\t\tplugins.push(new webpack.optimize.UglifyJsPlugin());\n\t\t\tplugins.push(new ExtractTextPlugin(\"[name].css\"));\n\t\n\t\t\tcssLoader.loader = ExtractTextPlugin.extract('style', 'css');\n\t\t\tsassLoader.loader = ExtractTextPlugin.extract('style', 'css!sass');\n\t\t} else {\n\t\t\tplugins.push(new webpack.HotModuleReplacementPlugin());\n\t\t\tappEntry.splice(0, 0, \"webpack-hot-middleware/client\");\n\t\t}\n\t\n\t\t// ----------------------\n\t\t// WEBPACK CONFIG\n\t\treturn {\n\t\t\tdevtool: devTool,\n\t\t\tentry: {\n\t\t\t\tapplication: appEntry,\n\t\t\t\tvendor: vendorModules\n\t\t\t},\n\t\t\toutput: {\n\t\t\t\tpath: path.join(dirname, \"public\", \"build\"),\n\t\t\t\tfilename: \"[name].js\",\n\t\t\t\tpublicPath: \"/build/\"\n\t\t\t},\n\t\t\tresolve: {\n\t\t\t\talias: {\n\t\t\t\t\tshared: path.join(dirname, \"src\", \"shared\")\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodule: {\n\t\t\t\tloaders: [{ test: /\\.js$/, loader: \"babel\", exclude: /node_modules/ }, { test: /\\.js$/, loader: \"eslint\", exclude: /node_modules/ }, { test: /\\.(png|jpg|jpeg|gif|woff|ttf|eot|svg|woff2)/, loader: \"url-loader?limit=1024\" }, cssLoader, sassLoader]\n\t\t\t},\n\t\t\tplugins: plugins\n\t\t};\n\t\t// ----------------------\n\t}\n\t\n\tmodule.exports = createConfig(true);\n\tmodule.exports.create = createConfig;\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"path\");\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports) {\n\n\tmodule.exports = require(\"extract-text-webpack-plugin\");\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// server.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap cc67762d521949634e03","import \"source-map-support/register\";\n\nimport express from \"express\";\nimport http from \"http\";\nimport socketIo from \"socket.io\";\nimport chalk from \"chalk\";\nimport {Observable} from \"rxjs\";\n\nimport \"shared/operators\";\nimport {ObservableSocket} from \"shared/observable-socket\";\n\nimport {UsersModule} from \"./modules/users\";\nimport {PlaylistModule} from \"./modules/playlist\";\nimport {ChatModule} from \"./modules/chat\";\n\n// --------------------------------------\n// Setup\nconst app = express();\nconst server = new http.Server(app);\nconst io = socketIo(server);\n\nconst isDevelopment = process.env.NODE_ENV !== \"production\";\n\n// --------------------------------------\n// Client Webpack\nif (process.env.USE_WEBPACK === \"true\") {\n\tvar webpackMiddleware = require(\"webpack-dev-middleware\"),\n\t\twebpackHotMiddleware = require(\"webpack-hot-middleware\"),\n\t\twebpack = require(\"webpack\"),\n\t\tclientConfig = require(\"../../webpack.client\");\n\n\tconst compiler = webpack(clientConfig);\n\tapp.use(webpackMiddleware(compiler, {\n\t\tpublicPath: \"/build/\",\n\t\tstats: {\n\t\t\tcolers: true,\n\t\t\tchunks: false,\n\t\t\tassets: false,\n\t\t\ttiming: false,\n\t\t\tmodules: false,\n\t\t\thash: false,\n\t\t\tversion: false\n\t\t}\n\t}));\n\n\tapp.use(webpackHotMiddleware(compiler));\n\tconsole.log(chalk.bgRed(\"Using webPack Dev Middleware. This is for dev only!\"));\n}\n\n// --------------------------------------\n// Configure Express\napp.set(\"view engine\", \"jade\");\napp.use(express.static(\"public\"));\n\nconst useExternalStyles = !isDevelopment;\napp.get(\"/\", (req, res) => {\n\tres.render(\"index\", { useExternalStyles });\n});\n\n// --------------------------------------\n// Services\nconst videoServices = [];\nconst playlistRepository = {};\n\n\n// --------------------------------------\n// Modules\nconst users = new UsersModule(io);\nconst chat = new ChatModule(io, users);\nconst playlist = new PlaylistModule(io, users, playlistRepository, videoServices);\nconst modules = [users, chat, playlist];\n\n// --------------------------------------\n// Socket\nio.on(\"connection\", socket => {\n\tconsole.log(`Got connection from ${socket.request.connection.remoteAddress}`);\n\n\tconst client = new ObservableSocket(socket);\n\tfor (let mod of modules)\n\t\tmod.registerClient(client);\n\n\tfor (let mod of modules)\n\t\tmod.clientRegistered(client);\n});\n\n// --------------------------------------\n// Startup\n\nconst port = process.env.PORT || 3000;\nfunction startServer() {\n\tserver.listen(port, () => {\n\t\tconsole.log(`Started http server on ${port}`);\n\t});\n}\n\nObservable.merge(...modules.map(m => m.init$()))\n\t.subscribe({\n\t\tcomplete() {\n\t\t\tstartServer();\n\t\t},\n\n\t\terror(error) {\n\t\t\tconsole.error(`Could not init module: ${error.stack || error}`);\n\t\t}\n\t});\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"rxjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rxjs\"\n// module id = 6\n// module chunks = 0","import {Observable} from \"rxjs\";\n\nObservable.prototype.safeSubscribe = function(next, error, complete) {\n\tconst subscription = this.subscribe(\n\t\titem => {\n\t\t\ttry {\n\t\t\t\tnext(item);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e.stack || e);\n\t\t\t\tsubscription.unsubscribe();\n\t\t\t}\n\t\t}, error, complete);\n\n\treturn subscription;\n};\n\nObservable.prototype.catchWrap = function() {\n\treturn this.catch(error => Observable.of({error: error}));\n};\n\n\n// WEBPACK FOOTER //\n// ./src/shared/operators.js","import {Observable, ReplaySubject} from \"rxjs\";\n\nexport function clientMessage(message) {\n\tconst error = new Error(message);\n\terror.clientMessage = message;\n\treturn error;\n}\n\nexport function fail(message) {\n\treturn Observable.throw({clientMessage: message});\n}\n\nlet successObservable = Observable.empty();\nexport function success() {\n\treturn successObservable;\n}\n\nexport class ObservableSocket {\n\tget isConnected() { return this._state.isConnected; }\n\tget isReconnecting() { return this._state.isReconnecting; }\n\tget isTotallyDead() { return !this.isConnected && !this.isReconnecting; }\n\n\tconstructor(socket) {\n\t\tthis._socket = socket;\n\t\tthis._state = {};\n\t\tthis._actionCallbacks = {};\n\t\tthis._requests = {};\n\t\tthis._nextRequestId = 0;\n\n\t\t// socket.on(\"connect\", () => this._state = {isConnected: true});\n\t\t// socket.on(\"disconnect\", () => this._state = {isConnected: false});\n\t\tthis.status$ = Observable.merge(\n\t\t\tthis.on$(\"connect\").map(() => ({ isConnected: true })),\n\t\t\tthis.on$(\"disconnect\").map(() => ({ isConnected: false })),\n\t\t\tthis.on$(\"reconnecting\").map(attempt => ({ isConnected: false, isReconnecting: true, attempt })),\n\t\t\tthis.on$(\"reconnect_fail\").map(() => ({ isConnected: false, isReconnecting: false})))\n\t\t\t.publishReplay(1)\n\t\t\t.refCount();\n\n\t\tthis.status$.subscribe(state => this._state = state);\n\t}\n\n\t// ---------------------\n\t// Basic Wrappers\n\ton$(event) {\n\t\treturn Observable.fromEvent(this._socket, event);\n\t}\n\n\ton(event, callback) {\n\t\tthis._socket.on(event, callback);\n\t}\n\n\toff(event, callback) {\n\t\tthis._socket.off(event, callback);\n\t}\n\n\temit(event, arg) {\n\t\tthis._socket.emit(event, arg);\n\t}\n\n\t// ---------------------\n\t// Emit (Client Side)\n\temitAction$(action, arg) {\n\t\tconst id = this._nextRequestId++;\n\t\tthis._registerCallbacks(action);\n\n\t\tconst subject = this._requests[id] = new ReplaySubject(1);\n\t\tthis._socket.emit(action, arg, id);\n\t\treturn subject;\n\t}\n\n\t_registerCallbacks(action) {\n\t\tif (this._actionCallbacks.hasOwnProperty(action))\n\t\t\treturn;\n\n\t\tthis._socket.on(action, (arg, id) => {\n\t\t\tconst request = this._popRequest(id);\n\t\t\tif (!request)\n\t\t\t\treturn;\n\n\t\t\trequest.next(arg);\n\t\t\trequest.complete();\n\t\t});\n\n\t\tthis._socket.on(`${action}:fail`, (arg, id) => {\n\t\t\tconst request = this._popRequest(id);\n\t\t\tif (!request) \n\t\t\t\treturn;\n\n\t\t\trequest.error(arg);\n\t\t});\n\n\t\tthis._actionCallbacks[action] = true;\n\t}\n\n\t_popRequest(id) {\n\t\tif (!this._requests.hasOwnProperty(id)) {\n\t\t\tconsole.error(`Event with ${id} was returned twice, or the server did not send back an ID`);\n\t\t}\n\n\t\tconst request = this._requests[id];\n\t\tdelete this._requests[id];\n\t\treturn request;\n\t}\n\n\t// ---------------------\n\t// On (Server Side)\n\tonAction(action, callback) {\n\t\tthis._socket.on(action, (arg, requestId) => {\n\t\t\ttry {\n\t\t\t\tconst value = callback(arg);\n\t\t\t\tif (!value) {\n\t\t\t\t\tthis._socket.emit(action, null, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (typeof(value.subscribe) !== \"function\") {\n\t\t\t\t\tthis._socket.emit(action, value, requestId);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet hasValue = false;\n\t\t\t\tvalue.subscribe({\n\t\t\t\t\tnext: (item) => {\n\t\t\t\t\t\tif (hasValue)\n\t\t\t\t\t\t\tthrow new Error(`Action ${action} produced more than one value`);\n\n\t\t\t\t\t\tthis._socket.emit(action, item, requestId);\n\t\t\t\t\t\thasValue = true;\n\t\t\t\t\t},\n\n\t\t\t\t\terror: (error) => {\n\t\t\t\t\t\tthis._emitError(action, requestId, error);\n\t\t\t\t\t\tconsole.error(error.stack || error);\n\t\t\t\t\t},\n\n\t\t\t\t\tcomplete: () => {\n\t\t\t\t\t\tif (!hasValue)\n\t\t\t\t\t\t\tthis._socket.emit(action, null, requestId);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\tif (typeof(requestId) !== \"undefined\")\n\t\t\t\t\tthis._emitError(action, requestId, error);\n\n\t\t\t\tconsole.error(error.stack || error);\n\t\t\t}\n\t\t});\n\t}\n\n\tonActions(actions) {\n\t\tfor (let action in actions) {\n\t\t\tif (!actions.hasOwnProperty(action))\n\t\t\t\tcontinue;\n\n\t\t\tthis.onAction(action, actions[action]);\n\t\t}\n\t}\n\n\t_emitError(action, id, error) {\n\t\tconst message = (error && error.clientMessage) || \"Fatal Error\";\n\t\tthis._socket.emit(`${action}:fail`, {message}, id);\n\t}\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/observable-socket.js","import _ from \"lodash\";\nimport {Observable} from \"rxjs\";\n\nimport {ModuleBase} from \"../lib/module\";\nimport {validateLogin} from \"shared/validation/users\";\nimport {fail} from \"shared/observable-socket\";\n\nconst AuthContext = Symbol(\"AuthContext\");\n\nexport class UsersModule extends ModuleBase {\n\tconstructor(io) {\n\t\tsuper();\n\t\tthis._io = io;\n\t\tthis._userList = [];\n\t\tthis._users = {};\n\t}\n\n\tgetColorForUsername(username) {\n\t\tlet hash = _.reduce(username, \n\t\t\t(hash, ch) => ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash, 0);\n\n\t\thash = Math.abs(hash);\n\t\tconst hue = hash % 360,\n\t\t\tsaturation = hash % 25 + 70,\n\t\t\tlightness = 100 - (hash % 15 + 35);\n\n\t\treturn `hsl(${hue}, ${saturation}%, ${lightness}%)`;\n\t}\n\n\tgetUserForClient(client) {\n\t\tconst auth = client[AuthContext];\n\t\tif (!auth)\n\t\t\treturn null;\n\n\t\treturn auth.isLoggedIn ? auth : null;\n\t}\n\n\tloginClient$(client, username) {\n\t\tusername = username.trim();\n\n\t\tconst validator = validateLogin(username);\n\t\tif (!validator.isValid)\n\t\t\treturn validator.throw$();\n\n\t\tif (this._users.hasOwnProperty(username))\n\t\t\treturn fail(`Username ${username} is already taken`);\n\n\t\tconst auth = client[AuthContext] || (client[AuthContext] = {});\n\t\tif (auth.isLoggedIn)\n\t\t\treturn fail(\"You are already logged in\");\n\n\t\tauth.name = username;\n\t\tauth.color = this.getColorForUsername(username);\n\t\tauth.isLoggedIn = true;\n\n\t\tthis._users[username] = client;\n\t\tthis._userList.push(auth);\n\n\t\tthis._io.emit(\"users:added\", auth);\n\t\tconsole.log(`User ${username} logged in`);\n\t\treturn Observable.of(auth);\n\t}\n\n\tlogoutClient(client) {\n\t\tconst auth = this.getUserForClient(client);\n\t\tif (!auth)\n\t\t\treturn;\n\n\t\tconst index = this._userList.indexOf(auth);\n\t\tthis._userList.splice(index, 1);\n\t\tdelete this._users[auth.name];\n\t\tdelete client[AuthContext];\n\n\t\tthis._io.emit(\"users:removed\", auth);\n\t\tconsole.log(`User ${auth.name} logged out`);\n\t}\n\n\tregisterClient(client) {\n\t\tclient.onActions({\n\t\t\t\"users:list\": () => {\n\t\t\t\treturn this._userList;\n\t\t\t},\n\n\t\t\t\"auth:login\": ({name}) => {\n\t\t\t\treturn this.loginClient$(client, name);\n\t\t\t},\n\n\t\t\t\"auth:logout\": () => {\n\t\t\t\tthis.logoutClient(client);\n\t\t\t}\n\t\t});\n\n\t\tclient.on(\"disconnect\", () => {\n\t\t\tthis.logoutClient(client);\n\t\t});\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/users.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 10\n// module chunks = 0","import {Observable} from \"rxjs\";\n\n/*eslint no-unused-vars: \"off\"*/\n\nexport class ModuleBase {\n\tinit$() {\n\t\treturn Observable.empty();\n\t}\n\n\tregisterClient(client) {\n\t}\n\n\tclientRegistered(client) {\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/module.js","import {Validator} from \"../validator\";\n\nexport let USERNAME_REGEX = /^[\\w\\d_-]+$/;\n\nexport function validateLogin(username) {\n\tconst validator = new Validator();\n\n\tif (username.length >= 10)\n\t\tvalidator.error(\"Username must be fewer than 10 characters\");\n\n\tif (!USERNAME_REGEX.test(username))\n\t\tvalidator.error(\"Username can only contain numbers, digits, underscores and dashes\");\n\n\treturn validator;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/users.js","import {Observable} from \"rxjs\";\n\nexport class Validator {\n\tget isValid() { return !this._errors.length; }\n\tget errors() { return this._errors; }\n\tget message() { return this._errors.join(\", \"); }\n\n\tconstructor() {\n\t\tthis._errors = [];\n\t}\n\n\terror(message) {\n\t\tthis._errors.push(message);\n\t}\n\n\ttoObject() {\n\t\tif (this.isValid)\n\t\t\treturn {};\n\n\t\treturn {\n\t\t\terrors: this._errors,\n\t\t\tmessage: this.message\n\t\t};\n\t}\n\n\tthrow$() {\n\t\treturn Observable.throw({clientMessage: this.message});\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validator.js","import {ModuleBase} from \"../lib/module\";\n\nexport class PlaylistModule extends ModuleBase {\n\tconstructor(io, usersModule, playlistRepository, videoServices) {\n\t\tsuper();\n\n\t\tthis._io = io;\n\t\tthis._users = usersModule;\n\t\tthis._repository = playlistRepository;\n\t\tthis._services = videoServices;\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/playlist.js","import {ModuleBase} from \"../lib/module\";\n\nimport {validateSendMessage} from \"shared/validation/chat\";\nimport {fail} from \"shared/observable-socket\";\n\nconst MAX_HISTORY = 100;\nconst BATCH_SIZE = 10;\n\nexport class ChatModule extends ModuleBase {\n\tconstructor(io, usersModule) {\n\t\tsuper();\n\t\tthis._io = io;\n\t\tthis._users = usersModule;\n\t\tthis._chatLog = [];\n\t}\n\n\tsendMessage(user, message, type) {\n\t\tmessage = message.trim();\n\n\t\tconst validator = validateSendMessage(user, message, type);\n\t\tif (!validator.isValid)\n\t\t\treturn validator.throw$();\n\n\t\tconst newMessage = {\n\t\t\tuser: {name: user.name, color: user.color},\n\t\t\tmessage: message,\n\t\t\ttime: new Date().getTime(),\n\t\t\ttype: type\n\t\t};\n\n\t\tthis._chatLog.push(newMessage);\n\n\t\tif (this._chatLog.length >= MAX_HISTORY)\n\t\t\tthis._chatLog.splice(0, BATCH_SIZE);\n\n\t\tthis._io.emit(\"chat:added\", newMessage);\n\t}\n\n\tregisterClient(client) {\n\t\tclient.onActions({\n\t\t\t\"chat:list\": () => {\n\t\t\t\treturn this._chatLog;\n\t\t\t},\n\n\t\t\t\"chat:add\": ({message, type}) => {\n\t\t\t\ttype = type || \"normal\";\n\n\t\t\t\tconst user = this._users.getUserForClient(client);\n\t\t\t\tif (!user)\n\t\t\t\t\treturn fail(\"You must be logged in\");\n\n\t\t\t\tthis.sendMessage(user, message, type);\n\t\t\t}\n\t\t});\n\t}\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/chat.js","import _ from \"lodash\";\nimport {Validator} from \"../validator\";\n\nexport let MESSAGE_TYPES = [\"normal\"];\n\nexport function validateSendMessage(user, message, type) {\n\tconst validator = new Validator();\n\n\tif (message.length > 50)\n\t\tvalidator.error(\"Message must be smaller than 50 characters\");\n\n\tif (message.trim().length === 0)\n\t\tvalidator.error(\"Message cannot be empty\");\n\n\tif (!_.includes(MESSAGE_TYPES, type))\n\t\tvalidator.error(`Invalid message type ${type}`);\n\n\treturn validator;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/chat.js","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 19\n// module chunks = 0","var path = require(\"path\"),\n\twebpack = require(\"webpack\"),\n\tExtractTextPlugin = require(\"extract-text-webpack-plugin\");\n\nconst vendorModules = [\"jquery\", \"socket.io-client\", \"rxjs\", \"moment\"];\n\nconst dirname = path.resolve(\"./\");\nfunction createConfig(isDebug) {\n\tconst devTool = isDebug ? \"eval-source-map\" : \"source-map\";\n\tconst plugins = [new webpack.optimize.CommonsChunkPlugin(\"vendor\", \"vendor.js\")];\n\n\tconst cssLoader = {test: /\\.css$/, loader: \"style!css\"};\n\tconst sassLoader = {test: /\\.scss$/, loader: \"style!css!sass\"};\n\tconst appEntry = [\"./src/client/application.js\"];\n\n\tif (!isDebug) {\n\t\tplugins.push(new webpack.optimize.UglifyJsPlugin());\n\t\tplugins.push(new ExtractTextPlugin(\"[name].css\"));\n\n\t\tcssLoader.loader = ExtractTextPlugin.extract('style', 'css');\n\t\tsassLoader.loader = ExtractTextPlugin.extract('style', 'css!sass');\n\t} else {\n\t\tplugins.push(new webpack.HotModuleReplacementPlugin());\n\t\tappEntry.splice(0,0, \"webpack-hot-middleware/client\");\n\t}\n\n\t// ----------------------\n\t// WEBPACK CONFIG\n\treturn {\n\t\tdevtool: devTool,\n\t\tentry: {\n\t\t\tapplication: appEntry,\n\t\t\tvendor: vendorModules\n\t\t},\n\t\toutput:{\n\t\t\tpath: path.join(dirname, \"public\", \"build\"),\n\t\t\tfilename: \"[name].js\",\n\t\t\tpublicPath: \"/build/\"\n\t\t},\n\t\tresolve: {\n\t\t\talias: {\n\t\t\t\tshared: path.join(dirname, \"src\", \"shared\")\n\t\t\t}\n\t\t},\n\t\tmodule: {\n\t\t\tloaders: [\n\t\t\t\t{ test: /\\.js$/, loader: \"babel\", exclude: /node_modules/ },\n\t\t\t\t{ test: /\\.js$/, loader: \"eslint\", exclude: /node_modules/ },\n\t\t\t\t{ test: /\\.(png|jpg|jpeg|gif|woff|ttf|eot|svg|woff2)/, loader: \"url-loader?limit=1024\" },\n\t\t\t\tcssLoader,\n\t\t\t\tsassLoader\n\t\t\t]\n\t\t},\n\t\tplugins: plugins\n\t};\n\t// ----------------------\n}\n\nmodule.exports = createConfig(true);\nmodule.exports.create = createConfig;\n\n\n// WEBPACK FOOTER //\n// ./webpack.client.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 21\n// module chunks = 0","module.exports = require(\"extract-text-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-text-webpack-plugin\"\n// module id = 22\n// module chunks = 0"],"sourceRoot":""}